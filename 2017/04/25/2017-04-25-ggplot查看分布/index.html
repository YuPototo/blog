<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>ggplot系列之三：查看一组连续变量的分布 • 商业与数据</title><meta name="description" content="ggplot系列之三：查看一组连续变量的分布 - Yu Qin"><link rel="icon" href="/blog/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/blog/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/blog/atom.xml" title="商业与数据"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/blog/atom.xml" title="商业与数据" type="application/atom+xml">
<!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/blog/" title="商业与数据">商业与数据</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/blog/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/blog/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="https://github.com/YuPototo" target="_blank">GITHUB</a></li></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ggplot系列之三：查看一组连续变量的分布</h1><div class="post-info"><a></a>2017-04-25</div><div class="post-content"><img src="/blog/2017/04/25/2017-04-25-ggplot%E6%9F%A5%E7%9C%8B%E5%88%86%E5%B8%83/plot_4.png" class="" title="直方图-例子">


<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>我们拿到了一个调查数据，每个用户输入了自己的年龄，我们想查看用户的年龄分布。这个问题场景其实可以抽象为：<strong>查看一个连续变量的分布情况</strong>。这时，我们可以使用直方图（histogram plot）或密度图（density plot）。</p>
<p>这篇文章展示两种图片的代码，并讨论该选择哪一种图片。</p>
<a id="more"></a>


<h2 id="模拟数据"><a href="#模拟数据" class="headerlink" title="模拟数据"></a>模拟数据</h2><p>我们先生成 simulated data：</p>
<ul>
<li>变量1：性别，男或女</li>
<li>变量2：重量，符合正太分布</li>
<li>数量：男女各两百各观测值</li>
</ul>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">1234</span>)</span><br><span class="line">wdata &lt;- data.frame(</span><br><span class="line">  sex = factor(rep(c(<span class="string">"女"</span>, <span class="string">"男"</span>), each=<span class="number">200</span>)),</span><br><span class="line">  weight = c(rnorm(<span class="number">200</span>, <span class="number">55</span>), rnorm(<span class="number">200</span>, <span class="number">58</span>)))</span><br><span class="line">head(wdata)</span><br></pre></td></tr></tbody></table></figure>


<h2 id="histogram"><a href="#histogram" class="headerlink" title="histogram"></a>histogram</h2><p>histogram 把一组连续变量分成若干组，并展示各个组的频数。ggplot 可以对连续变量自动分组，我们也可以手动设定每一组的区间范围。具体使用多大的组距，要根据业务情况确定。</p>
<p>我们先做第一张图，不区分男女。</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = wdata) + </span><br><span class="line">  geom_histogram(aes(x = weight)) +</span><br><span class="line">  labs(title = <span class="string">'体重分布'</span>,</span><br><span class="line">       x = <span class="string">'重量（公斤）'</span>,</span><br><span class="line">       y = <span class="string">'数量'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>结果如下图：</p>
<img src="/blog/2017/04/25/2017-04-25-ggplot%E6%9F%A5%E7%9C%8B%E5%88%86%E5%B8%83/plot_1.png" class="" title="直方图">


<p>可以看到全部人群的重量分布有两个中心。如果这是一个正常的数据分析，我们会猜测可能有其他因素影响了分布，其中性别是最符合直觉的，所以这个时候我会对性别做一个分组，再画一张图。（虽然这里的数据是我直接 simulate 的，我已经提前知道答案了，但这个分析思路不会有改变）。</p>
<p>更新做图代码：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = wdata) + </span><br><span class="line">  geom_histogram(aes(x = weight, fill = sex)) +</span><br><span class="line">  labs(title = <span class="string">'体重分布'</span>,</span><br><span class="line">       x = <span class="string">'重量（公斤）'</span>,</span><br><span class="line">       y = <span class="string">'数量'</span>,</span><br><span class="line">       fill = <span class="string">'性别'</span>)</span><br></pre></td></tr></tbody></table></figure>


<img src="/blog/2017/04/25/2017-04-25-ggplot%E6%9F%A5%E7%9C%8B%E5%88%86%E5%B8%83/plot_2.png" class="" title="直方图">


<p>这个时候我们可以清晰地看到不同性别有自己的体重分布。</p>
<h2 id="density-plot"><a href="#density-plot" class="headerlink" title="density plot"></a>density plot</h2><p>density plot 按照一个公式把数据转换成了“密度”，它跟 histogram 的区别可以查看<a href="https://math.stackexchange.com/questions/2666834/what-is-the-difference-between-frequency-and-density-in-a-histogram" target="_blank" rel="noopener">这个回答</a>。</p>
<p>代码如下：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = wdata) + </span><br><span class="line">  geom_density(aes(x = weight, fill = sex)) + </span><br><span class="line">  labs(title = <span class="string">'体重分布'</span>,</span><br><span class="line">       x = <span class="string">'重量（公斤）'</span>,</span><br><span class="line">       y = <span class="string">'数量'</span>,</span><br><span class="line">       fill = <span class="string">'性别'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>细心的你会发现，我们只修改了一行代码，具体来说，我们把 <code>geom_histogram</code> 变成了 <code>geom_density</code>，非常方便地生成了我们需要的图片。这就是 ggplot 厉害的地方。</p>
<p>结果如下图：</p>
<img src="/blog/2017/04/25/2017-04-25-ggplot%E6%9F%A5%E7%9C%8B%E5%88%86%E5%B8%83/plot_3.png" class="" title="直方图">

<p>可以看到，两个组别的正态分布更加明显。</p>
<h2 id="用-histogram-还是-density-呢？"><a href="#用-histogram-还是-density-呢？" class="headerlink" title="用 histogram 还是 density 呢？"></a>用 histogram 还是 density 呢？</h2><p>对比上面的两个图片，我们会看到：density 对趋势的展示更加明显。</p>
<p>我的思路如下：</p>
<ul>
<li>在样本足够多的情况下，我会优先查看 density，然后查看 histogram</li>
<li>但如果样本量不足，用 density 可能会对数据做出<strong>过度处理</strong>，这个时候优先查看 histogram</li>
<li>如果数据需要跟外部团队沟通，优先展示 histogram，因为同事可能不太理解 density 的意思，而解释起来的沟通成本也非常高，这个时候，我永远选择最容易帮助沟通的方案。有些想展示自己专业性的分析师，可能会选择使用 density plot，这不是个对团队效率有帮助的习惯。</li>
</ul>
<blockquote>
<p>在两个方案能达到相同效果时，永远选择最利于沟通的方案，而不是最利于展示自己“实力”的方案。</p>
</blockquote>
<p>上面这句话是我说的，也是我检验一个数据分析师是否合格的重要标准。当一个数据分析师优先展示自我而不是高效沟通时，他可能存在如下的问题：</p>
<ul>
<li>缺乏沟通能力，甚至不是个 team player</li>
<li>缺乏成本意识，很难成为企业里足够好的 leader，毕竟，管理者最重要的工作之一是做投入产出分析</li>
<li>不真诚，甚至会有不诚实的嫌疑，这对数据工作是非常致命的</li>
</ul>
<p>以上内容，也是我对自己的警醒。</p>
<h2 id="引申：用-geom-area-实现类似-density-的效果"><a href="#引申：用-geom-area-实现类似-density-的效果" class="headerlink" title="引申：用 geom_area 实现类似 density 的效果"></a>引申：用 geom_area 实现类似 density 的效果</h2><p>ggplot 还有一个 <code>geom_area</code> 函数，能实现类似直方图的功能。</p>
<p>我们试试用 <code>geom_area</code> 修改代码，并尝试使用另一个主题。代码如下：</p>
<figure class="highlight r"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = wdata) + </span><br><span class="line">  geom_area(aes(x = weight, fill = sex), stat =<span class="string">"bin"</span>, alpha=<span class="number">0.6</span>) +</span><br><span class="line">  theme_classic() + </span><br><span class="line">  theme(text=element_text(size=<span class="number">20</span>,  family=<span class="string">"STFangsong"</span>),</span><br><span class="line">        plot.title = element_text(hjust = <span class="number">0.5</span>)) +</span><br><span class="line">  labs(title = <span class="string">'体重分布'</span>,</span><br><span class="line">       x = <span class="string">'重量（公斤）'</span>,</span><br><span class="line">       y = <span class="string">'数量'</span>,</span><br><span class="line">       fill = <span class="string">'性别'</span>) </span><br></pre></td></tr></tbody></table></figure>

<p>结果如图：</p>
<img src="/blog/2017/04/25/2017-04-25-ggplot%E6%9F%A5%E7%9C%8B%E5%88%86%E5%B8%83/plot_4.png" class="" title="geom_area">

<p>这是一个看起来很舒服的可视化数据了，相信也会让你的报告更有说服力。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div></article></div></main><footer><div class="paginator"><a class="prev" href="/blog/2017/09/13/2017-09-13-distributions/">prev</a><a class="next" href="/blog/2017/03/04/2017-03-05-closure/">next</a></div><div class="copyright"><p>&copy; 2020 <a href="http://yoursite.com">Yu Qin</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>