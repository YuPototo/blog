---
title: 数据库设计的三范式
date: 2019-11-05 01:36:00
categories:
 - 开发
tags:
 - database
---

最近设计了一个 app 的数据库结构，经高人提醒，我学习了数据库设计的三范式。

数据库设计的三范式是指数据库设计的三大规则，这三个规则逐层递进，需要先满足第1个规则，然后才能进一步满足第2个规则。

虽然我用的是 Mongodb，学习三范式还是让我受益匪浅。

<!-- more -->

先看下面这个表格，我们将依次用三范式改造这个用户表格：

| 客户名 |    生日    |    购买的商品    | 城市      | 邮编 |
|:------:|:----------:|:----------------:|:-------:|:-------:|
|  张三  | 1985.01.01 | 足球1个, 篮球1个 |    上海   |  123 |
|  李四  | 1987.08.09 | 青菜2斤，鸡蛋1打 |    北京    |  456  |
|  李四  | 1993.12.12 |    iPhone 1个    |    广州   | 789 |
|  王五  | 2001.03.12 |     圆珠笔2只    |    深圳   |  246 |

## 第1范式

规则：
- 记录需要有唯一性，即数据需要一条 primary key
- 数据必须是最简形式
- 不能有重复的列

数据的唯一性。这里有两个重名的“李四”，我们只能通过生日区分他们。这是不好的。这个表格需要一个 primary key。

数据必须是最简形式。“足球1个, 篮球1个”显然不是最简单的形式，首先足球和篮球应该分开，其次，商品内容和数量也应该分开。（甚至单位也应该单独做一列，这里先不考虑这点）

因为不能有重复的列，我们需要把同一个人购买的不同商品放在不同的行。

下面是修改后的符合第1范式的表格：

| Customer key | 客户名 |    生日    |  商品  | 数量 | 城市 | 邮编 |
|:---:|:------:|:----------:|:------:|:----:|:-------:|:-------:|
|  1  |  张三  | 1985.01.01 |  足球  |   1  |    上海   | 123  |
|  1  |  张三  | 1985.01.01 |  篮球  |   1  |    上海  |  123  |
|  2  |  李四  | 1987.08.09 |  青菜  |   2  |    北京   |  456  |
|  2  |  李四  | 1987.08.09 |  鸡蛋  |   1  |    北京   | 456  |
|  3  |  李四  | 1993.12.12 | iphone |   1  |    广州   |  789  |
|  4  |  王五  | 2001.03.12 | 圆珠笔 |   2  |    深圳    |  246 |

## 第2范式

规则：
- 满足第1范式
- Primary Key 不能重复

所以我们应该把商品和数量转移到另外一个表格。

第1个表格： customer 表格里只有跟客户直接相关的信息。

| key | 客户名 |    生日    | 城市 | 邮编 |
|:---:|:------:|:----------:|:-------:| :-------:|
|  1  |  张三  | 1985.01.01 |    上海   | 123 |
|  2  |  李四  | 1987.08.09 |    北京  |  456 |
|  3  |  李四  | 1993.12.12 |    广州   |  789 |
|  4  |  王五  | 2001.03.12 |    深圳   |  246 |

第2个表格：商品表格，包含客户购买的商品，这里有个 foreign key，说明商品是哪个客户买的。

| key | foreign key |  商品  | 数量 |
|:---:|:-----------:|:------:|:----:|
|  1  |      1      |  足球  |   1  |
|  2  |      1      |  篮球  |   1  |
|  3  |      2      |  青菜  |   2  |
|  4  |      2      |  鸡蛋  |   1  |
|  5  |      3      | iphone |   1  |
|  6  |      4      | 圆珠笔 |   2  |


## 第3范式

规则：
- 满足第2范式
- Has no transitive functional dependencies（不知道这个怎么翻译)

什么是 transitive functional dependencies 呢？最典型的例子是上面表格里的“城市”和“邮编”，这两列是一一对应的，当我们修改其中一个时，必须修改另一个。

这种时候应该新建第3张 city 表，表中的“邮编”是 primary key。

| 邮编 | 城市 |
|:----:|:----:|
|  123 | 上海 |
|  456 | 北京 |
|  789 | 广州 |
|  246 | 深圳 |

同时，customer 表里的邮编变成 foregin key：


| key | 客户名 |    生日   | 邮编 |
|:---:|:------:|:----------:|:-------:|
|  1  |  张三  | 1985.01.01 | 123 |
|  2  |  李四  | 1987.08.09 | 456 |
|  3  |  李四  | 1993.12.12 | 789 |
|  4  |  王五  | 2001.03.12 | 246 |

以上就是三范式的例子。（写出来之后我终于感觉到自己理解了 :blush: ）

## 参考

- [What is Normalization? 1NF, 2NF, 3NF & BCNF with Examples](https://www.guru99.com/database-normalization.html)
- [Database Normalization Explained](https://towardsdatascience.com/database-normalization-explained-53e60a494495)