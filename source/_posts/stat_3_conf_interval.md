---
title:  如何理解“置信区间”
date: 2020-01-23 15:56:51
categories:
  - 统计学
tags:
  - R
  - Statistics
---

{% asset_img plot_0.png  "plot" %}

Google Play Store 对提供了商店页 A/B 测试功能，公司使用这个功能对新版商店页做了测试。测试结果会提供一个置信区间 confidence interval，同事很难理解置信区间的概念。

这篇文章尝试用普通人能理解的方式解释置信区间。

<!-- more -->

## 理解“总体”和“样本”

先给定一个研究问题：中国人里多少人喜欢足球。

这个问题里，“总体”是全体中国人，大概14亿。我们不可能调查所有中国人，所以必须用抽样调查的方法，**随机抽取**一定数量的人获取他们的观点。

抽取到的这部分人，被称为“样本”。

我们会用“样本”数据去**估计**总体的情况。


## 误差一定存在

核心前提：**即使是随机抽样，也会有误差**。

硬币理论上是平均的，那么我们扔10次硬币，正反面刚好55开的概率是多大呢？这是个二项分布。可以用 R 计算：

{% codeblock lang:r %}
dbinom(5, size=10, prob=0.5) 
{% endcodeblock %}

结果：24.6%。只有不到1/4的概率，我们能观测到5次正面和5次反面。所以，随机抽样无法避免误差。

随机调查1000个中国人，其中有12%的人喜欢足球，这个12%很大可能不是中国人喜欢足球的真实比率。

那么，我们如何根据这1000个人确定到底有多少中国人喜欢足球呢？

## 中心极限定理

这时统计学就发挥作用了。根据**中心极限定理**，在样本量足够大且抽样随机时，点估计值符合正态分布，且我们知道这个正态分布的标准差和均值。分布的均值就是样本的估计值，标准差可以用一个公式计算。

上面的表达比较抽象。更直接地说，对1000个人抽样是否喜欢足球的结果，可以让我们画出如下的正态分布图片：

{% asset_img plot_estimate_dist.png  "plot" %}

这个分布的均值是0.12，标准差是0.0103（用某个公式计算出，这里不讨论）。

## 分布函数的特征

一旦我们有了分布函数，我们就可以计算：
- 给定 x 范围，对应的概率是多少
- 给定一个概率，以均值为中心时，x 的上限和下限各是多少


### 用两个例子计算

对标准正态分布， - 1 < x < 1 的概率是多少呢？

{% codeblock lang:r %}
pnorm(1) - pnorm(-1)
{% endcodeblock %}

结果：68%。

对一个均值为3，标准差是0.5的正态分布，90%概率对应的上下限各是多少呢？

{% codeblock lang:r %}
upper_x <- qnorm(0.95, 3, sd = 0.5)
lower_x <- qnorm(0.05, 3, sd = 0.5)
{% endcodeblock %}

这里计算出的结果是：3.82 和 2.71，也就是说，该分布从 x = 2.71 到 x = 3.82 的部分，概率是90%。

###  计算调查数据

用这样的计算方法，我们可以计算刚才调查1000个中国人的数据。

我们从刚才的正态分布里找到一个上限和一个下限，让这之间的概率是 95%。

{% codeblock lang:r %}
sd <- sqrt(0.12 * 0.88 / 1000)
upper_x <- qnorm(0.975, 0.12, sd = sd)
lower_x <- qnorm(0.025, 0.12, sd = sd)
{% endcodeblock %}

我们得到下限是 0.1，上限是 0.14。

如下图（偷懒不用 R 做图了）：

{% asset_img plot_estimate_dist2.png  "plot" %}

根据这个计算，我们有95%的把握做出如下判断：10%到14%这个区间内包含中国人喜欢足球的真实比例。

严格地说，我们不能这样表达：中国人喜欢足球的真实比例有95%的概率落在10%到14%之间。这是个很微妙的区别，有兴趣的同学可以[进一步深究](https://www.graphpad.com/guides/prism/7/statistics/stat_more_about_confidence_interval.htm?toc=0&printWindow)。从业务角度来说，这个表达也是可以接受的，而且按照我个人经验，同事会更容易理解这个表达。

## 小结

那么，到底什么是置信区间呢？

如果我们有一个95%的置信区间，我们可以说，有95%的把握真实值落在置信区间内。



